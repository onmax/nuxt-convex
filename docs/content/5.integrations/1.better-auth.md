---
title: Better Auth
description: Use Convex as the database for Better Auth authentication.
---

# Better Auth Integration

Use Convex as the database backend for [Better Auth](https://better-auth.com) with the [`@onmax/nuxt-better-auth`](https://github.com/onmax/nuxt-better-auth) module.

## How It Works

- Auth runs on **Nuxt server** (SSR-compatible, route protection)
- Convex provides the **database** via HTTP adapter
- Uses `@convex-dev/better-auth` CRUD functions

## Setup

### 1. Install Dependencies

```bash
pnpm add @onmax/nuxt-better-auth @convex-dev/better-auth better-auth
```

### 2. Configure Nuxt

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  modules: ['nuxt-convex', '@onmax/nuxt-better-auth'],
})
```

### 3. Set Environment Variables

```bash [.env]
CONVEX_URL=https://your-project.convex.cloud
BETTER_AUTH_SECRET=your-secret-at-least-32-characters
```

### 4. Create Server Auth Config

```ts [server/auth.config.ts]
import { defineServerAuth } from '@onmax/nuxt-better-auth/config'

export default defineServerAuth(({ runtimeConfig }) => ({
  socialProviders: {
    github: {
      clientId: runtimeConfig.github?.clientId || '',
      clientSecret: runtimeConfig.github?.clientSecret || '',
    },
  },
}))
```

### 5. Create Client Auth Config

```ts [app/auth.config.ts]
import { defineClientAuth } from '@onmax/nuxt-better-auth/config'

export default defineClientAuth({})
```

### 6. Create Convex Auth Functions

Export CRUD functions that the Better Auth adapter will call:

```ts [convex/auth.ts]
import { createApi } from '@convex-dev/better-auth'
import schema from './schema'

export const { create, findOne, findMany, updateOne, updateMany, deleteOne, deleteMany }
  = createApi(schema, () => ({}))
```

### 7. Add Auth Tables to Schema

Add Better Auth tables to your Convex schema:

```ts [convex/schema.ts]
import { defineSchema, defineTable } from 'convex/server'
import { v } from 'convex/values'

const authTables = {
  user: defineTable({
    name: v.string(),
    email: v.string(),
    emailVerified: v.boolean(),
    image: v.optional(v.union(v.null(), v.string())),
    createdAt: v.number(),
    updatedAt: v.number(),
  })
    .index('email_name', ['email', 'name'])
    .index('name', ['name']),
  session: defineTable({
    expiresAt: v.number(),
    token: v.string(),
    createdAt: v.number(),
    updatedAt: v.number(),
    ipAddress: v.optional(v.union(v.null(), v.string())),
    userAgent: v.optional(v.union(v.null(), v.string())),
    userId: v.string(),
  })
    .index('expiresAt', ['expiresAt'])
    .index('expiresAt_userId', ['expiresAt', 'userId'])
    .index('token', ['token'])
    .index('userId', ['userId']),
  account: defineTable({
    accountId: v.string(),
    providerId: v.string(),
    userId: v.string(),
    accessToken: v.optional(v.union(v.null(), v.string())),
    refreshToken: v.optional(v.union(v.null(), v.string())),
    idToken: v.optional(v.union(v.null(), v.string())),
    accessTokenExpiresAt: v.optional(v.union(v.null(), v.number())),
    refreshTokenExpiresAt: v.optional(v.union(v.null(), v.number())),
    scope: v.optional(v.union(v.null(), v.string())),
    password: v.optional(v.union(v.null(), v.string())),
    createdAt: v.number(),
    updatedAt: v.number(),
  })
    .index('accountId', ['accountId'])
    .index('accountId_providerId', ['accountId', 'providerId'])
    .index('providerId_userId', ['providerId', 'userId'])
    .index('userId', ['userId']),
  verification: defineTable({
    identifier: v.string(),
    value: v.string(),
    expiresAt: v.number(),
    createdAt: v.number(),
    updatedAt: v.number(),
  })
    .index('expiresAt', ['expiresAt'])
    .index('identifier', ['identifier']),
}

export default defineSchema({
  ...authTables,
  // your other tables
})
```

### 8. Deploy Convex

```bash
npx convex deploy
```

## Usage

### Client-Side

```vue
<script setup lang="ts">
const { user, signIn, signOut } = useUserSession()
</script>

<template>
  <div v-if="user">
    <p>Welcome, {{ user.name }}</p>
    <button @click="signOut()">
      Sign Out
    </button>
  </div>
  <div v-else>
    <button @click="signIn.social({ provider: 'github' })">
      Sign in with GitHub
    </button>
  </div>
</template>
```

### Server-Side

```ts [server/api/protected.ts]
export default defineEventHandler(async (event) => {
  const session = await requireUserSession(event)
  return { user: session.user }
})
```

## Performance

HTTP latency to Convex (~50-200ms per DB call) is acceptable for auth operations:

- Login/signup are infrequent
- Use JWE session cookies to minimize DB reads
- Enable `cookieCache` for session caching

```ts [server/auth.config.ts]
export default defineServerAuth({
  session: {
    cookieCache: { enabled: true, maxAge: 7 * 24 * 60 * 60, strategy: 'jwe' },
  },
})
```
