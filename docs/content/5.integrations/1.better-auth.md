---
title: Better Auth
description: Use Convex as the database for Better Auth authentication.
---

Use Convex as the database backend for [Better Auth](https://better-auth.com) with `@onmax/nuxt-better-auth`.

`nuxt-convex` registers the `convex` database provider via the `better-auth:database:providers` hook. `@onmax/nuxt-better-auth` then generates `#auth/database` from that provider.

::important
This integration runs on the server. `auth.database.provider = 'convex'` is not available in `clientOnly` mode.
::

::steps

### Install dependencies

```bash
pnpm add @onmax/nuxt-better-auth @convex-dev/better-auth better-auth
```

### Configure Nuxt

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  modules: ['nuxt-convex', '@onmax/nuxt-better-auth'],
  auth: {
    database: {
      provider: 'convex',
      // Optional override (highest priority).
      // convexUrl: 'https://your-project.convex.cloud',
    },
  },
})
```

### Set environment variables

```bash [.env]
CONVEX_URL=https://your-project.convex.cloud
BETTER_AUTH_SECRET=your-secret-at-least-32-characters
```

### Create Better Auth config files

`@onmax/nuxt-better-auth` loads these files by default:

- `server/auth.config.ts`
- `app/auth.config.ts`

```ts [server/auth.config.ts]
import { defineServerAuth } from '@onmax/nuxt-better-auth/config'

export default defineServerAuth(({ runtimeConfig }) => ({
  socialProviders: {
    github: {
      clientId: runtimeConfig.github?.clientId || '',
      clientSecret: runtimeConfig.github?.clientSecret || '',
    },
  },
}))
```

```ts [app/auth.config.ts]
import { defineClientAuth } from '@onmax/nuxt-better-auth/config'

export default defineClientAuth({})
```

### Create Convex auth functions

Create a `convex/auth.ts` file that exports the CRUD functions the adapter calls.

```ts [convex/auth.ts]
import { createApi } from '@convex-dev/better-auth'
import schema from './schema'

export const {
  create,
  findOne,
  findMany,
  updateOne,
  updateMany,
  deleteOne,
  deleteMany,
} = createApi(schema, () => ({}))
```

### Add auth tables to your Convex schema

Add the Better Auth tables to `convex/schema.ts`.

::collapsible{title="Example schema (Better Auth tables)"}

```ts [convex/schema.ts]
import { defineSchema, defineTable } from 'convex/server'
import { v } from 'convex/values'

const authTables = {
  user: defineTable({
    name: v.string(),
    email: v.string(),
    emailVerified: v.boolean(),
    image: v.optional(v.union(v.null(), v.string())),
    createdAt: v.number(),
    updatedAt: v.number(),
  })
    .index('email_name', ['email', 'name'])
    .index('name', ['name']),
  session: defineTable({
    expiresAt: v.number(),
    token: v.string(),
    createdAt: v.number(),
    updatedAt: v.number(),
    ipAddress: v.optional(v.union(v.null(), v.string())),
    userAgent: v.optional(v.union(v.null(), v.string())),
    userId: v.string(),
  })
    .index('expiresAt', ['expiresAt'])
    .index('expiresAt_userId', ['expiresAt', 'userId'])
    .index('token', ['token'])
    .index('userId', ['userId']),
  account: defineTable({
    accountId: v.string(),
    providerId: v.string(),
    userId: v.string(),
    accessToken: v.optional(v.union(v.null(), v.string())),
    refreshToken: v.optional(v.union(v.null(), v.string())),
    idToken: v.optional(v.union(v.null(), v.string())),
    accessTokenExpiresAt: v.optional(v.union(v.null(), v.number())),
    refreshTokenExpiresAt: v.optional(v.union(v.null(), v.number())),
    scope: v.optional(v.union(v.null(), v.string())),
    password: v.optional(v.union(v.null(), v.string())),
    createdAt: v.number(),
    updatedAt: v.number(),
  })
    .index('accountId', ['accountId'])
    .index('accountId_providerId', ['accountId', 'providerId'])
    .index('providerId_userId', ['providerId', 'userId'])
    .index('userId', ['userId']),
  verification: defineTable({
    identifier: v.string(),
    value: v.string(),
    expiresAt: v.number(),
    createdAt: v.number(),
    updatedAt: v.number(),
  })
    .index('expiresAt', ['expiresAt'])
    .index('identifier', ['identifier']),
}

export default defineSchema({
  ...authTables,
  // your other tables
})
```

::

### Deploy Convex

```bash
npx convex deploy
```

::

## Usage

### Client-side

```vue
<script setup lang="ts">
const { user, signIn, signOut } = useUserSession()
</script>

<template>
  <div v-if="user">
    <p>Welcome, {{ user.name }}</p>
    <button @click="signOut()">
      Sign Out
    </button>
  </div>
  <div v-else>
    <button @click="signIn.social({ provider: 'github' })">
      Sign in with GitHub
    </button>
  </div>
</template>
```

### Server-side

```ts [server/api/protected.ts]
export default defineEventHandler(async (event) => {
  const session = await requireUserSession(event)
  return { user: session.user }
})
```

## Performance

HTTP latency to Convex is typically acceptable for auth operations:

- Login/signup are infrequent.
- JWE session cookies minimize DB reads.
- `cookieCache` reduces repeated session lookups.

```ts [server/auth.config.ts]
export default defineServerAuth({
  session: {
    cookieCache: { enabled: true, maxAge: 7 * 24 * 60 * 60, strategy: 'jwe' },
  },
})
```

